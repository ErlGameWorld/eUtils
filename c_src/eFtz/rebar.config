{port_specs, [
   {"../../priv/eNifFtz.so", ["*.cc"]}
]}.

% {port_env, [
% 	{"(linux|solaris|freebsd|netbsd|openbsd|dragonfly|gnu)", "CXXFLAGS", "$CXXFLAGS -O3 -DNDEBUG -fPIC -std=c++20 -fvisibility=hidden -fvisibility-inlines-hidden -fno-rtti -fno-strict-aliasing -ffunction-sections -fdata-sections -flto -fno-semantic-interposition $EXTRA_CXXFLAGS"},
% 	{"(linux|solaris|freebsd|netbsd|openbsd|dragonfly|gnu)", "LDFLAGS", "$LDFLAGS -shared -pthread -Wl,-O1 -Wl,--as-needed -Wl,--gc-sections -flto $EXTRA_LDFLAGS"},
%
% 	{"darwin", "CXXFLAGS", "$CXXFLAGS -O3 -DNDEBUG -fPIC -std=c++20 -fvisibility=hidden -fvisibility-inlines-hidden -fno-rtti -fno-strict-aliasing -ffunction-sections -fdata-sections -flto=thin $EXTRA_CXXFLAGS"},
% 	{"darwin", "LDFLAGS", "$LDFLAGS -dynamiclib -undefined dynamic_lookup -dead_strip -flto=thin $EXTRA_LDFLAGS"},
%
% 	{"win32|windows", "CXXFLAGS", "$CXXFLAGS /O2 /DNDEBUG /GL /Gy /std:c++20 -pthread /Zc:__cplusplus /GR- /Oi /Zc:inline /EHsc /utf-8 /wd4100 /wd4711 /wd4710 /wd4267 /wd4820 /wd4365 $EXTRA_CXXFLAGS"},
% 	{"win32|windows", "LDFLAGS", "$LDFLAGS /LTCG /INCREMENTAL:NO /OPT:REF,ICF $EXTRA_LDFLAGS"}
%
% ]}.

{port_env, [
   %% =========================================================================
   %% Linux / Unix (GCC)
   %% =========================================================================
   {"(linux|solaris|freebsd|netbsd|openbsd|dragonfly|gnu)", "CXXFLAGS",
      "$CXXFLAGS "
      "-std=c++20 "                    %% 必须：代码依赖 C++20 <chrono>
      "-O3 -DNDEBUG "                  %% 优化：最高优化等级，移除调试断言
      "-fPIC "                         %% 必须：位置无关代码 (用于共享库)
      "-fvisibility=hidden "           %% 优化：隐藏非 NIF_INIT 的符号
      "-fvisibility-inlines-hidden "   %% 优化：隐藏内联函数符号
      "-fno-rtti "                     %% 优化：代码未使用 dynamic_cast，禁用 RTTI 减小体积
      "-fno-strict-aliasing "          %% 安全：防止 NIF 指针转换被过度优化
      "-Wall -Wextra "                 %% 建议：开启警告以发现潜在 bug
      "-flto "                         %% 优化：链接时优化 (这对模板繁重的 chrono 库很有用)
      "-fno-semantic-interposition "   %% 优化：允许编译器更激进地内联函数
      "$EXTRA_CXXFLAGS"
   },

   {"(linux|solaris|freebsd|netbsd|openbsd|dragonfly|gnu)", "LDFLAGS",
      "$LDFLAGS "
      "-shared "
      "-pthread "                      %% 必须：支持 atomic 和 thread_local
      "-flto "                         %% 必须：配合 CXXFLAGS 的 LTO
      "-Wl,-O1 "                       %% 优化：链接器优化
      "-Wl,--as-needed "               %% 优化：只链接用到的库
      "-Wl,--gc-sections "             %% 优化：移除未使用的代码段
      "$EXTRA_LDFLAGS"
   },

   %% =========================================================================
   %% macOS (Clang)
   %% =========================================================================
   {"darwin", "CXXFLAGS",
      "$CXXFLAGS "
      "-std=c++20 "
      "-stdlib=libc++ "                %% 建议：明确指定使用 LLVM 的 libc++
      "-O3 -DNDEBUG "
      "-fPIC "
      "-fvisibility=hidden "
      "-fvisibility-inlines-hidden "
      "-fno-rtti "
      "-fno-strict-aliasing "
      "-flto=thin "                    %% 优化：Apple Clang 推荐使用 thin LTO
      "$EXTRA_CXXFLAGS"
   },

   {"darwin", "LDFLAGS",
      "$LDFLAGS "
      "-dynamiclib "
      "-undefined dynamic_lookup "
      "-flto=thin "                    %% 必须：配合 CXXFLAGS 的 LTO
      "$EXTRA_LDFLAGS"
   },

   %% =========================================================================
   %% Windows (MSVC)
   %% =========================================================================
   {"win32|windows", "CXXFLAGS",
      "$CXXFLAGS "
      "/std:c++20 "                    %% 必须：C++20 标准
      "/O2 /DNDEBUG "                  %% 优化：发布模式优化
      "/EHsc "                         %% 关键：启用 C++ 异常处理 (代码中有 try-catch)
      "/GL "                           %% 优化：全程序优化 (LTO)
      "/Gy "                           %% 优化：函数级链接
      "/Zc:__cplusplus "               %% 兼容性：正确报告 __cplusplus 宏的值
      "/Zc:inline "                    %% 优化：更智能的内联移除
      "/GR- "                          %% 优化：禁用 RTTI (对应 -fno-rtti)
      "/utf-8 "                        %% 兼容性：强制源文件和执行字符集为 UTF-8
      %% 警告屏蔽 (根据代码实际情况微调):
      "/wd4100 "                       %% 忽略 '未引用的形参' (常见于 NIF argc/argv)
      "/wd4710 /wd4711 "               %% 忽略内联相关的各种提示性警告
      "$EXTRA_CXXFLAGS"
   },

   {"win32|windows", "LDFLAGS",
      "$LDFLAGS "
      "/LTCG "                         %% 必须：配合 /GL 进行链接时代码生成
      "/INCREMENTAL:NO "               %% 优化：禁用增量链接 (发布版不需要)
      "/OPT:REF,ICF "                  %% 优化：移除未引用函数，合并相同数据
      "$EXTRA_LDFLAGS"
   }
]}.

